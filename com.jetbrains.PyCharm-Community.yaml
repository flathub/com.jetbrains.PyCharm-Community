app-id: com.jetbrains.PyCharm-Community
runtime: org.freedesktop.Sdk
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: pycharm
separate-locales: false
rename-icon: pycharm
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --filesystem=host
  - --socket=session-bus
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --filesystem=xdg-run/keyring
  - --device=all
  - --env=PYCHARM_JDK=${FLATPAK_DEST}/pycharm/jre64/
  - --env=PATH=/app/bin:/usr/bin:/app/extensions/bin:/app/packages/bin
  - --env=PYTHONPATH=/app/packages/python
add-extensions:
  com.jetbrains.PyCharm.Extensions:
    directory: extensions
    version: '21.08'
    add-ld-path: lib
    merge-dirs: bin;lib
    subdirectories: true
    no-autodownload: true
  com.jetbrains.PyCharm.Packages:
    directory: packages
    version: '21.08'
    add-ld-path: lib
    merge-dirs: bin;lib;python
    subdirectories: true
    no-autodownload: true
modules:
  - name: virtualenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        virtualenv
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/c7/3e/b11275c99dd779e4fc87931f7c82ce93767080249bfa4d7aea7ea748800e/virtualenv-20.10.0.tar.gz
        sha256: 576d05b46eace16a9c348085f7d0dc8ef28713a2cabaa1cf0aea41e8f12c9218
        x-checker-data:
          type: pypi
          name: virtualenv
      - type: file
        url: https://files.pythonhosted.org/packages/33/68/e72f8c047e7f25b20c9df02163d925dc734bbee46597018e122a2bce9d3e/setuptools-59.1.1.tar.gz
        sha256: 94ee891f4759150cded601a6beb6b08400413aefd0267b692f3f8c6e0bb238e7
        x-checker-data:
          type: pypi
          name: setuptools
      - type: file
        url: &wheel_url https://files.pythonhosted.org/packages/4e/be/8139f127b4db2f79c8b117c80af56a3078cc4824b5b94250c7f81a70e03b/wheel-0.37.0.tar.gz
        sha256: &wheel_sha256 e2ef7239991699e3355d54f8e968a21bb940a1dbf34a4d226741e64462516fad
        x-checker-data:
          type: pypi
          name: wheel
      - type: file
        url: https://files.pythonhosted.org/packages/4b/0d/ecb9595fae02467edba5023eb8a23c688d2b438a6a8d1a9e2b8649faf23d/setuptools_scm-6.3.2.tar.gz
        sha256: a49aa8081eeb3514eb9728fa5040f2eaa962d6c6f4ec9c32f6c1fba88f88a0f2
        x-checker-data:
          type: pypi
          name: setuptools-scm
      - type: file
        url: https://files.pythonhosted.org/packages/79/3f/aae4a951dc5bd2738901e053c057f4b317bf12199f09351f63a002442117/filelock-3.4.0.tar.gz
        sha256: 93d512b32a23baf4cac44ffd72ccf70732aeff7b8050fcaf6d3ec406d954baf4
        x-checker-data:
          type: pypi
          name: filelock
      - type: file
        url: https://files.pythonhosted.org/packages/d7/d8/05696357e0311f5b5c316d7b95f46c669dd9c15aaeecbb48c7d0aeb88c40/appdirs-1.4.4.tar.gz
        sha256: 7d5d0167b2b1ba821647616af46a749d1c653740dd0d2415100fe26e27afdf41
        x-checker-data:
          type: pypi
          name: appdirs
      - type: file
        url: https://files.pythonhosted.org/packages/56/ed/9c876a62efda9901863e2cc8825a13a7fcbda75b4b498103a4286ab1653b/distlib-0.3.3.zip
        sha256: d982d0751ff6eaaab5e2ec8e691d949ee80eddf01a62eaa96ddb11531fe16b05
        x-checker-data:
          type: pypi
          name: distlib
      - type: file
        url: https://files.pythonhosted.org/packages/4b/96/d70b9462671fbeaacba4639ff866fb4e9e558580853fc5d6e698d0371ad4/platformdirs-2.4.0.tar.gz
        sha256: 367a5e80b3d04d2428ffa76d33f124cf11e8fff2acdaa9b43d545f5c7d661ef2
        x-checker-data:
          type: pypi
          name: platformdirs
      - type: file
        url: https://files.pythonhosted.org/packages/be/ba/1f744cdc819428fc6b5084ec34d9b30660f6f9daaf70eead706e3203ec3c/toml-0.10.2.tar.gz
        sha256: b3bda1d108d5dd99f4a20d24d9c348e91c4db7ab1b749200bded2f839ccbe68f
        x-checker-data:
          type: pypi
          name: toml
      - type: file
        url: https://files.pythonhosted.org/packages/71/16/edd003270daaab0168f7dbac6e22b055322e9ba66fb2cc951f58d1ed158b/backports.entry_points_selectable-1.1.1.tar.gz
        sha256: 914b21a479fde881635f7af5adc7f6e38d6b274be32269070c53b698c60d5386
        x-checker-data:
          type: pypi
          name: backports.entry-points-selectable
      - type: file
        url: https://files.pythonhosted.org/packages/aa/5b/62165da80cbc6e1779f342234c7ddc6c6bc9e64cef149046a9c0456f912b/tomli-1.2.2.tar.gz
        sha256: c6ce0015eb38820eaf32b5db832dbc26deb3dd427bd5f6556cf0acac2c214fee
        x-checker-data:
          type: pypi
          name: tomli
      - type: file
        url: https://files.pythonhosted.org/packages/6f/cd/3653de7b1d61f0ef95f2459ac752f23a91dbc84f991787201aa52d0cf1cc/flit_core-3.3.0.tar.gz
        sha256: b1404accffd6504b5f24eeca9ec5d3c877f828d16825348ba81515fa084bd5f0
        # x-checker-data:
        #   type: pypi
        #   name: flit-core
      - type: file
        url: https://files.pythonhosted.org/packages/df/9e/d1a7217f69310c1db8fdf8ab396229f55a699ce34a203691794c5d1cad0c/packaging-21.3.tar.gz
        sha256: dd47c42927d89ab911e606518907cc2d3a1f38bbd026385970643f9c5b8ecfeb
        x-checker-data:
          type: pypi
          name: packaging
      - type: file
        url: https://files.pythonhosted.org/packages/c1/47/dfc9c342c9842bbe0036c7f763d2d6686bcf5eb1808ba3e170afdb282210/pyparsing-2.4.7.tar.gz
        sha256: c203ec8783bf771a155b207279b9bccb8dea02d8f0c9e5f8ead507bc3246ecc1
        # x-checker-data:
        #   type: pypi
        #   name: pyparsing

  - name: pipenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        pipenv
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/d5/3a/c0cb462882da253cad436e09a165f2ae2dd8056d0ee91f7b0f902b51dde2/pipenv-2021.11.15.tar.gz
        sha256: 616766b1e8dfc24b2e7c6dfbbc8276b7d7ba07e778e5eb0f1b6e59fcd4532fd1
        x-checker-data:
          type: pypi
          name: pipenv
      - type: file
        url: &setuptools_url https://files.pythonhosted.org/packages/9a/74/de4d8c69466b6413b1616048b39f8b73d65f98c15f6202b68ccfc9550f1f/setuptools-58.0.4.tar.gz
        sha256: &setuptools_sha256 f10059f0152e0b7fb6b2edd77bcb1ecd4c9ed7048a826eb2d79f72fd2e6e237b
      - type: file
        url: *wheel_url
        sha256: *wheel_sha256
      - type: file
        url: &virtualenv_url https://files.pythonhosted.org/packages/6d/89/9691b0d0521c069bd238585ccb7f4035b8393d843a50491270e7dae0209e/virtualenv-20.7.2.tar.gz
        sha256: &virtualenv_sha256 9ef4e8ee4710826e98ff3075c9a4739e2cb1040de6a2a8d35db0055840dc96a0
      - type: file
        url: https://files.pythonhosted.org/packages/6c/ae/d26450834f0acc9e3d1f74508da6df1551ceab6c2ce0766a593362d6d57f/certifi-2021.10.8.tar.gz
        sha256: 78884e7c1d4b00ce3cea67b44566851c4343c120abd683433ce934a68ea58872
        x-checker-data:
          type: pypi
          name: certifi
      - type: file
        url: https://files.pythonhosted.org/packages/85/76/49120db3bb8de4073ac199a08dc7f11255af8968e1e14038aee95043fafa/virtualenv-clone-0.5.7.tar.gz
        sha256: 418ee935c36152f8f153c79824bb93eaf6f0f7984bae31d3f48f350b9183501a
        x-checker-data:
          type: pypi
          name: virtualenv-clone

  - name: conda
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        conda
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/74/4e/c533c3136427be62c38cc0e038cabf167bb54489c2ced2f6df903c456861/conda-4.3.16.tar.gz
        sha256: a91ef821343dea3ba9670f3d10b36c1ace4f4c36d70c175d8fc8886e94285953
        x-checker-data:
          type: pypi
          name: conda
      - type: file
        url: https://files.pythonhosted.org/packages/c0/fd/e38d68774c0a345b0090d608a90f1fbf423970d812f7ec7aef9ac024e648/pycosat-0.6.3.zip
        sha256: 4c99874946a7e939bb941bbb019dd2c20e6068e3107c91366e7779c69d70e0ed
        x-checker-data:
          type: pypi
          name: pycosat
      - type: file
        url: https://files.pythonhosted.org/packages/e7/01/3569e0b535fb2e4a6c384bdbed00c55b9d78b5084e0fb7f4d0bf523d7670/requests-2.26.0.tar.gz
        sha256: b8aa58f8cf793ffd8782d3d8cb19e66ef36f7aba4353eec859e74678b01b07a7
        x-checker-data:
          type: pypi
          name: requests
      - type: file
        url: https://files.pythonhosted.org/packages/4d/15/7fc04de02ca774342800c9adf1a8239703977c49c5deaadec1689ec85506/ruamel.yaml-0.17.17.tar.gz
        sha256: 9751de4cbb57d4bfbf8fc394e125ed4a2f170fbff3dc3d78abf50be85924f8be
        x-checker-data:
          type: pypi
          name: ruamel.yaml
      - type: file
        url: https://files.pythonhosted.org/packages/ee/2d/9cdc2b527e127b4c9db64b86647d567985940ac3698eeabc7ffaccb4ea61/chardet-4.0.0.tar.gz
        sha256: 0d6f53a15db4120f2b08c94f11e7d93d2c911ee118b6b30a04ec3ee8310179fa
        x-checker-data:
          type: pypi
          name: chardet
      - type: file
        url: https://files.pythonhosted.org/packages/62/08/e3fc7c8161090f742f504f40b1bccbfc544d4a4e09eb774bf40aafce5436/idna-3.3.tar.gz
        sha256: 9d643ff0a55b762d5cdb124b8eaa99c66322e2157b69160bc32796e824360e6d
        x-checker-data:
          type: pypi
          name: idna
      - type: file
        url: https://files.pythonhosted.org/packages/80/be/3ee43b6c5757cabea19e75b8f46eaf05a2f5144107d7db48c7cf3a864f73/urllib3-1.26.7.tar.gz
        sha256: 4987c65554f7a2dbf30c18fd48778ef124af6fab771a377103da0585e2336ece
        x-checker-data:
          type: pypi
          name: urllib3
      - type: file
        url: https://files.pythonhosted.org/packages/8b/25/08e5ad2431a028d0723ca5540b3af6a32f58f25e83c6dda4d0fcef7288a3/ruamel.yaml.clib-0.2.6.tar.gz
        sha256: 4ff604ce439abb20794f05613c374759ce10e3595d1867764dd1ae675b85acbd
        x-checker-data:
          type: pypi
          name: ruamel.yaml.clib
      - type: file
        url: https://files.pythonhosted.org/packages/9f/c5/334c019f92c26e59637bb42bd14a190428874b2b2de75a355da394cf16c1/charset-normalizer-2.0.7.tar.gz
        sha256: e019de665e2bcf9c2b64e2e5aa025fa991da8720daa3c1138cadd2fd1856aed0
        x-checker-data:
          type: pypi
          name: charset-normalizer

  - name: pycharm
    buildsystem: simple
    build-commands:
      - mkdir pycharm
      - tar xzfv pycharm-community.tar.gz --directory=pycharm/ --strip-components=1
      - rm -f pycharm/help/*
      - install -dm755 ${FLATPAK_DEST}/bin
      - install -dm755 ${FLATPAK_DEST}/pycharm
      - cp -r pycharm/* ${FLATPAK_DEST}/pycharm
      - chmod -R a-s,go+rX,go-w ${FLATPAK_DEST}/pycharm
      - python3 ${FLATPAK_DEST}/pycharm/plugins/python-ce/helpers/pydev/setup_cython.py
        build_ext --inplace
      - install pycharm/bin/pycharm.sh ${FLATPAK_DEST}/bin/pycharm
      - install -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps -Dm644 pycharm/bin/pycharm.svg
      - install -t ${FLATPAK_DEST}/share/applications/ -Dm644 com.jetbrains.PyCharm-Community.desktop
      - install -t ${FLATPAK_DEST}/share/appdata/ -Dm644 com.jetbrains.PyCharm-Community.appdata.xml
      - icon_in="${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/pycharm.svg"; icon_out="${FLATPAK_ID}.png";
        for s in {32,64,128,256,512}; do rsvg-convert "${icon_in}" -w "${s}" -h "${s}"
        -a -f png -o "${icon_out}"; install -p -Dm644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
        done;
      - install -d "${FLATPAK_DEST}/extensions"
      - install -d "${FLATPAK_DEST}/packages"
    sources:
      - type: file
        url: https://download.jetbrains.com/python/pycharm-community-2021.2.3.tar.gz
        sha256: 99ed5ebf5ebae4a1726c535072d4be1bb32e5ef48e328dbc9ab85afe26c42855
        dest-filename: pycharm-community.tar.gz
        x-checker-data:
          type: jetbrains
          code: PCC
      - type: file
        path: com.jetbrains.PyCharm-Community.appdata.xml
      - type: file
        path: com.jetbrains.PyCharm-Community.desktop

  - name: wrapper
    buildsystem: meson
    config-opts:
      - -Deditor_binary=/app/pycharm/bin/pycharm.sh
      - -Dprogram_name=pycharm
      - -Deditor_title=PyCharm
    sources:
      - type: dir
        path: jetbrains-flatpak-wrapper
