app-id: com.jetbrains.PyCharm-Community
runtime: org.freedesktop.Sdk
runtime-version: '19.08'
sdk: org.freedesktop.Sdk
command: pycharm-desktop
separate-locales: false
rename-icon: pycharm
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --filesystem=host
  - --socket=session-bus
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --filesystem=xdg-run/keyring
  - --device=all
  - --env=PYCHARM_JDK=${FLATPAK_DEST}/pycharm/jre64/
modules:
  - shared-modules/glew/glew.json
  - shared-modules/glu/glu-9.json
  - shared-modules/python2.7/python-2.7.json

  - name: freeglut
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=Release
      - -DOpenGL_GL_PREFERENCE=LEGACY
      - -DFREEGLUT_BUILD_DEMOS=OFF
      - -DFREEGLUT_BUILD_STATIC_LIBS=OFF
    sources:
      - type: archive
        url: https://downloads.sourceforge.net/freeglut/freeglut-3.2.1.tar.gz
        sha256: d4000e02102acaf259998c870e25214739d1f16f67f99cb35e4f46841399da68

  - name: python2-virtualenv
    buildsystem: simple
    build-commands:
      - pip2 install --no-index --find-links="file://${PWD}" --install-option="--prefix=${FLATPAK_DEST}"
        virtualenv
      - mv ${FLATPAK_DEST}/bin/virtualenv ${FLATPAK_DEST}/bin/virtualenv2
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e7/80/15d28e5a075fb02366ce97558120bb987868dab3600233ec7be032dc6d01/virtualenv-16.7.7.tar.gz
        sha256: d257bb3773e48cac60e475a19b608996c73f4d333b3ba2e4e57d5ac6134e0136
      - type: file
        url: https://files.pythonhosted.org/packages/11/0a/7f13ef5cd932a107cd4c0f3ebc9d831d9b78e1a0e8c98a098ca17b1d7d97/setuptools-41.6.0.zip
        sha256: 6afa61b391dcd16cb8890ec9f66cc4015a8a31a6e1c2b4e0c464514be1a3d722
      - type: file
        url: https://files.pythonhosted.org/packages/59/b0/11710a598e1e148fb7cbf9220fd2a0b82c98e94efbdecb299cb25e7f0b39/wheel-0.33.6.tar.gz
        sha256: 10c9da68765315ed98850f8e048347c3eb06dd81822dc2ab1d4fde9dc9702646

  - name: python3-virtualenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        virtualenv
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/e7/80/15d28e5a075fb02366ce97558120bb987868dab3600233ec7be032dc6d01/virtualenv-16.7.7.tar.gz
        sha256: d257bb3773e48cac60e475a19b608996c73f4d333b3ba2e4e57d5ac6134e0136
      - type: file
        url: https://files.pythonhosted.org/packages/11/0a/7f13ef5cd932a107cd4c0f3ebc9d831d9b78e1a0e8c98a098ca17b1d7d97/setuptools-41.6.0.zip
        sha256: 6afa61b391dcd16cb8890ec9f66cc4015a8a31a6e1c2b4e0c464514be1a3d722
      - type: file
        url: https://files.pythonhosted.org/packages/59/b0/11710a598e1e148fb7cbf9220fd2a0b82c98e94efbdecb299cb25e7f0b39/wheel-0.33.6.tar.gz
        sha256: 10c9da68765315ed98850f8e048347c3eb06dd81822dc2ab1d4fde9dc9702646

  - name: python3-pipenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        pipenv
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/fd/e9/01822318551caa0d62a181ba3b10f0f3757bb1e270da97165bd52db92776/pipenv-2018.11.26.tar.gz
        sha256: a673e606e8452185e9817a987572b55360f4d28b50831ef3b42ac3cab3fee846
      - type: file
        url: https://files.pythonhosted.org/packages/94/3e/edcf6fef41d89187df7e38e868b2dd2182677922b600e880baad7749c865/six-1.13.0.tar.gz
        sha256: 30f610279e8b2578cab6db20741130331735c781b56053c59c4076da27f06b66
      - type: file
        url: https://files.pythonhosted.org/packages/98/c3/2c227e66b5e896e15ccdae2e00bbc69aa46e9a8ce8869cc5fa96310bf612/attrs-19.3.0.tar.gz
        sha256: f7b7ce16570fe9965acd6d30101a28f62fb4a7f9e926b3bbc9b61f8b04247e72
      - type: file
        url: https://files.pythonhosted.org/packages/eb/e9/378a72d8790faee46688cd35a233c091b26ee41255a9657155d15e675da0/Arpeggio-1.9.0.tar.gz
        sha256: a5258b84f76661d558492fa87e42db634df143685a0e51802d59cae7daad8732
      - type: file
        url: https://files.pythonhosted.org/packages/bc/c6/2b1d2ec1b30e570c548fa841ab729ddb83bddf08100082d263c080faa5c3/invoke-1.3.0.tar.gz
        sha256: c52274d2e8a6d64ef0d61093e1983268ea1fc0cd13facb9448c4ef0c9a7ac7da
      - type: file
        url: https://files.pythonhosted.org/packages/74/75/ee4710c824c601a9201b71c6ee38b09d38f2db1796dabb193f3f80a4a9f5/parver-0.2.1.tar.gz
        sha256: 1b37a691af145a3a193eff269d53ba5b2ab16dfbb65d47d85360755919f5fe4b
      - type: file
        url: https://files.pythonhosted.org/packages/11/0a/7f13ef5cd932a107cd4c0f3ebc9d831d9b78e1a0e8c98a098ca17b1d7d97/setuptools-41.6.0.zip
        sha256: 6afa61b391dcd16cb8890ec9f66cc4015a8a31a6e1c2b4e0c464514be1a3d722
      - type: file
        url: https://files.pythonhosted.org/packages/59/b0/11710a598e1e148fb7cbf9220fd2a0b82c98e94efbdecb299cb25e7f0b39/wheel-0.33.6.tar.gz
        sha256: 10c9da68765315ed98850f8e048347c3eb06dd81822dc2ab1d4fde9dc9702646
      - type: file
        url: https://files.pythonhosted.org/packages/d7/a7/08b88808c409722361459f1ae24474530d83593d6ded346f1d3649326838/virtualenv-clone-0.5.3.tar.gz
        sha256: c88ae171a11b087ea2513f260cdac9232461d8e9369bcd1dc143fc399d220557
      - type: file
        url: https://files.pythonhosted.org/packages/62/85/7585750fd65599e88df0fed59c74f5075d4ea2fe611deceb95dd1c2fb25b/certifi-2019.9.11.tar.gz
        sha256: e4f3620cfea4f83eedc95b24abd9cd56f3c4b146dd0177e83a21b4eb49e21e50
      - type: file
        url: https://files.pythonhosted.org/packages/5b/82/1462f86e6c3600f2471d5f552fcc31e39f17717023df4bab712b4a9db1b3/pytest-runner-5.2.tar.gz
        sha256: 96c7e73ead7b93e388c5d614770d2bae6526efd997757d3543fe17b557a0942b

  - name: pycharm
    buildsystem: simple
    build-commands:
      - mkdir pycharm
      - tar xzfv pycharm-community.tar.gz --directory=pycharm/ --strip-components=1
      - rm -f pycharm/help/*
      - install -dm755 ${FLATPAK_DEST}/bin
      - install -dm755 ${FLATPAK_DEST}/pycharm
      - cp -r pycharm/* ${FLATPAK_DEST}/pycharm
      - chmod -R a-s,go+rX,go-w ${FLATPAK_DEST}/pycharm
      - python3 ${FLATPAK_DEST}/pycharm/plugins/python-ce/helpers/pydev/setup_cython.py
        build_ext --inplace
      - install pycharm/bin/pycharm.sh ${FLATPAK_DEST}/bin/pycharm
      - install -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps -Dm644 pycharm/bin/pycharm.svg
      - install -t ${FLATPAK_DEST}/share/applications/ -Dm644 com.jetbrains.PyCharm-Community.desktop
      - install -t ${FLATPAK_DEST}/share/appdata/ -Dm644 com.jetbrains.PyCharm-Community.appdata.xml
      - install -m755 pycharm-desktop ${FLATPAK_DEST}/bin/pycharm-desktop
      - icon_in="${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/pycharm.svg"; icon_out="${FLATPAK_ID}.png";
        for s in {32,64,128,256,512}; do rsvg-convert "${icon_in}" -w "${s}" -h "${s}"
        -a -f png -o "${icon_out}"; install -p -Dm644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
        done;
    sources:
      - type: file
        url: https://download.jetbrains.com/python/pycharm-community-2020.2.tar.gz
        sha256: 60b2eeea5237f536e5d46351fce604452ce6b16d037d2b7696ef37726e1ff78a
        dest-filename: pycharm-community.tar.gz
        x-checker-data:
          type: jetbrains
          code: PCC
        size: 399199416
      - type: file
        path: com.jetbrains.PyCharm-Community.appdata.xml
      - type: file
        path: com.jetbrains.PyCharm-Community.desktop
      - type: script
        dest-filename: pycharm-desktop
        commands:
          - exec env PYCHARM_VM_OPTIONS=/app/pycharm/bin/pycharm64.vmoptions /app/pycharm/bin/pycharm.sh
            "$@"
