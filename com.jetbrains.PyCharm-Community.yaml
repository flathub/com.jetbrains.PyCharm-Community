app-id: com.jetbrains.PyCharm-Community
runtime: org.freedesktop.Sdk
runtime-version: '21.08'
sdk: org.freedesktop.Sdk
command: pycharm
separate-locales: false
rename-icon: pycharm
finish-args:
  - --share=ipc
  - --socket=x11
  - --share=network
  - --socket=pulseaudio
  - --filesystem=host
  - --socket=session-bus
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.freedesktop.secrets
  - --filesystem=xdg-run/keyring
  - --device=all
  - --env=PYCHARM_JDK=${FLATPAK_DEST}/pycharm/jre64/
  - --env=PATH=/app/bin:/usr/bin:/app/extensions/bin:/app/packages/bin
  - --env=PYTHONPATH=/app/packages/python
add-extensions:
  com.jetbrains.PyCharm.Extensions:
    directory: extensions
    version: '21.08'
    add-ld-path: lib
    merge-dirs: bin;lib
    subdirectories: true
    no-autodownload: true
  com.jetbrains.PyCharm.Packages:
    directory: packages
    version: '21.08'
    add-ld-path: lib
    merge-dirs: bin;lib;python
    subdirectories: true
    no-autodownload: true
modules:
  - name: virtualenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        virtualenv
    sources:
      - type: file
        url: &virtualenv_url https://files.pythonhosted.org/packages/6d/89/9691b0d0521c069bd238585ccb7f4035b8393d843a50491270e7dae0209e/virtualenv-20.7.2.tar.gz
        sha256: &virtualenv_sha256 9ef4e8ee4710826e98ff3075c9a4739e2cb1040de6a2a8d35db0055840dc96a0
        x-checker-data:
          type: pypi
          name: virtualenv
      - type: file
        url: &setuptools_url https://files.pythonhosted.org/packages/9a/74/de4d8c69466b6413b1616048b39f8b73d65f98c15f6202b68ccfc9550f1f/setuptools-58.0.4.tar.gz
        sha256: &setuptools_sha256 f10059f0152e0b7fb6b2edd77bcb1ecd4c9ed7048a826eb2d79f72fd2e6e237b
        x-checker-data:
          type: pypi
          name: setuptools
      - type: file
        url: &wheel_url https://files.pythonhosted.org/packages/4e/be/8139f127b4db2f79c8b117c80af56a3078cc4824b5b94250c7f81a70e03b/wheel-0.37.0.tar.gz
        sha256: &wheel_sha256 e2ef7239991699e3355d54f8e968a21bb940a1dbf34a4d226741e64462516fad
        x-checker-data:
          type: pypi
          name: wheel
      - type: file
        url: https://files.pythonhosted.org/packages/4e/62/056c0127bf45c493168167aed15c4ccb70d2c69154fb1f4acaffc2bab761/setuptools_scm-6.3.1.tar.gz
        sha256: 0f6a263912b13798c028b9a271d91af3bde0e42784091c797deccc3ad3a7f596
        x-checker-data:
          type: pypi
          name: setuptools-scm
      - type: file
        url: https://files.pythonhosted.org/packages/14/ec/6ee2168387ce0154632f856d5cc5592328e9cf93127c5c9aeca92c8c16cb/filelock-3.0.12.tar.gz
        sha256: 18d82244ee114f543149c66a6e0c14e9c4f8a1044b5cdaadd0f82159d6a6ff59
        x-checker-data:
          type: pypi
          name: filelock
      - type: file
        url: https://files.pythonhosted.org/packages/d7/d8/05696357e0311f5b5c316d7b95f46c669dd9c15aaeecbb48c7d0aeb88c40/appdirs-1.4.4.tar.gz
        sha256: 7d5d0167b2b1ba821647616af46a749d1c653740dd0d2415100fe26e27afdf41
        x-checker-data:
          type: pypi
          name: appdirs
      - type: file
        url: https://files.pythonhosted.org/packages/45/97/15fdbef466e12c890553cebb1d8b1995375202e30e0c83a1e51061556143/distlib-0.3.2.zip
        sha256: 106fef6dc37dd8c0e2c0a60d3fca3e77460a48907f335fa28420463a6f799736
        x-checker-data:
          type: pypi
          name: distlib
      - type: file
        url: https://files.pythonhosted.org/packages/e2/d4/c6ffe89de09851892b1418dc22f6ab019b7b6f362532ab813c262e1722bb/platformdirs-2.3.0.tar.gz
        sha256: 15b056538719b1c94bdaccb29e5f81879c7f7f0f4a153f46086d155dffcd4f0f
        x-checker-data:
          type: pypi
          name: platformdirs
      - type: file
        url: https://files.pythonhosted.org/packages/be/ba/1f744cdc819428fc6b5084ec34d9b30660f6f9daaf70eead706e3203ec3c/toml-0.10.2.tar.gz
        sha256: b3bda1d108d5dd99f4a20d24d9c348e91c4db7ab1b749200bded2f839ccbe68f
        x-checker-data:
          type: pypi
          name: toml
      - type: file
        url: https://files.pythonhosted.org/packages/e4/7e/249120b1ba54c70cf988a8eb8069af1a31fd29d42e3e05b9236a34533533/backports.entry_points_selectable-1.1.0.tar.gz
        sha256: 988468260ec1c196dab6ae1149260e2f5472c9110334e5d51adcb77867361f6a
        dest-filename: backports.entry-points-selectable-1.1.0.tar.gz
        x-checker-data:
          type: pypi
          name: backports.entry-points-selectable
      - type: file
        url: https://files.pythonhosted.org/packages/75/50/973397c5ba854445bcc396b593b5db1958da6ab8d665b27397daa1497018/tomli-1.2.1.tar.gz
        sha256: a5b75cb6f3968abb47af1b40c1819dc519ea82bcc065776a866e8d74c5ca9442
        x-checker-data:
          type: pypi
          name: tomli
      - type: file
        url: https://files.pythonhosted.org/packages/6f/cd/3653de7b1d61f0ef95f2459ac752f23a91dbc84f991787201aa52d0cf1cc/flit_core-3.3.0.tar.gz
        sha256: b1404accffd6504b5f24eeca9ec5d3c877f828d16825348ba81515fa084bd5f0
        x-checker-data:
          type: pypi
          name: flit-core
      - type: file
        url: https://files.pythonhosted.org/packages/df/86/aef78bab3afd461faecf9955a6501c4999933a48394e90f03cd512aad844/packaging-21.0.tar.gz
        sha256: 7dc96269f53a4ccec5c0670940a4281106dd0bb343f47b7471f779df49c2fbe7
        x-checker-data:
          type: pypi
          name: packaging
      - type: file
        url: https://files.pythonhosted.org/packages/c1/47/dfc9c342c9842bbe0036c7f763d2d6686bcf5eb1808ba3e170afdb282210/pyparsing-2.4.7.tar.gz
        sha256: c203ec8783bf771a155b207279b9bccb8dea02d8f0c9e5f8ead507bc3246ecc1
        x-checker-data:
          type: pypi
          name: pyparsing

  - name: pipenv
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        pipenv
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/be/c5/a7c300c4589e898db8cfcf26f7065c24e2f5abacaea196a7f80e6695344d/pipenv-2021.5.29.tar.gz
        sha256: 05958fadcd70b2de6a27542fcd2bd72dd5c59c6d35307fdac3e06361fb06e30e
        x-checker-data:
          type: pypi
          name: pipenv
      - type: file
        url: *setuptools_url
        sha256: *setuptools_sha256
      - type: file
        url: *wheel_url
        sha256: *wheel_sha256
      - type: file
        url: *virtualenv_url
        sha256: *virtualenv_sha256
      - type: file
        url: https://files.pythonhosted.org/packages/6d/78/f8db8d57f520a54f0b8a438319c342c61c22759d8f9a1cd2e2180b5e5ea9/certifi-2021.5.30.tar.gz
        sha256: 2bbf76fd432960138b3ef6dda3dde0544f27cbf8546c458e60baf371917ba9ee
        x-checker-data:
          type: pypi
          name: certifi
      - type: file
        url: https://files.pythonhosted.org/packages/85/76/49120db3bb8de4073ac199a08dc7f11255af8968e1e14038aee95043fafa/virtualenv-clone-0.5.7.tar.gz
        sha256: 418ee935c36152f8f153c79824bb93eaf6f0f7984bae31d3f48f350b9183501a
        x-checker-data:
          type: pypi
          name: virtualenv-clone

  - name: conda
    buildsystem: simple
    build-commands:
      - pip3 install --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST}
        conda
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/74/4e/c533c3136427be62c38cc0e038cabf167bb54489c2ced2f6df903c456861/conda-4.3.16.tar.gz
        sha256: a91ef821343dea3ba9670f3d10b36c1ace4f4c36d70c175d8fc8886e94285953
        x-checker-data:
          type: pypi
          name: conda
      - type: file
        url: https://files.pythonhosted.org/packages/c0/fd/e38d68774c0a345b0090d608a90f1fbf423970d812f7ec7aef9ac024e648/pycosat-0.6.3.zip
        sha256: 4c99874946a7e939bb941bbb019dd2c20e6068e3107c91366e7779c69d70e0ed
        x-checker-data:
          type: pypi
          name: pycosat
      - type: file
        url: https://files.pythonhosted.org/packages/e7/01/3569e0b535fb2e4a6c384bdbed00c55b9d78b5084e0fb7f4d0bf523d7670/requests-2.26.0.tar.gz
        sha256: b8aa58f8cf793ffd8782d3d8cb19e66ef36f7aba4353eec859e74678b01b07a7
        x-checker-data:
          type: pypi
          name: requests
      - type: file
        url: https://files.pythonhosted.org/packages/71/81/f597606e81f53eb69330e3f8287e9b5a3f7ed0481824036d550da705cd82/ruamel.yaml-0.17.16.tar.gz
        sha256: 1a771fc92d3823682b7f0893ad56cb5a5c87c48e62b5399d6f42c8759a583b33
        x-checker-data:
          type: pypi
          name: ruamel.yaml
      - type: file
        url: https://files.pythonhosted.org/packages/ee/2d/9cdc2b527e127b4c9db64b86647d567985940ac3698eeabc7ffaccb4ea61/chardet-4.0.0.tar.gz
        sha256: 0d6f53a15db4120f2b08c94f11e7d93d2c911ee118b6b30a04ec3ee8310179fa
        x-checker-data:
          type: pypi
          name: chardet
      - type: file
        url: https://files.pythonhosted.org/packages/cb/38/4c4d00ddfa48abe616d7e572e02a04273603db446975ab46bbcd36552005/idna-3.2.tar.gz
        sha256: 467fbad99067910785144ce333826c71fb0e63a425657295239737f7ecd125f3
        x-checker-data:
          type: pypi
          name: idna
      - type: file
        url: https://files.pythonhosted.org/packages/4f/5a/597ef5911cb8919efe4d86206aa8b2658616d676a7088f0825ca08bd7cb8/urllib3-1.26.6.tar.gz
        sha256: f57b4c16c62fa2760b7e3d97c35b255512fb6b59a259730f36ba32ce9f8e342f
        x-checker-data:
          type: pypi
          name: urllib3
      - type: file
        url: https://files.pythonhosted.org/packages/8b/25/08e5ad2431a028d0723ca5540b3af6a32f58f25e83c6dda4d0fcef7288a3/ruamel.yaml.clib-0.2.6.tar.gz
        sha256: 4ff604ce439abb20794f05613c374759ce10e3595d1867764dd1ae675b85acbd
        x-checker-data:
          type: pypi
          name: ruamel.yaml.clib
      - type: file
        url: https://files.pythonhosted.org/packages/e7/4e/2af0238001648ded297fb54ceb425ca26faa15b341b4fac5371d3938666e/charset-normalizer-2.0.4.tar.gz
        sha256: f23667ebe1084be45f6ae0538e4a5a865206544097e4e8bbcacf42cd02a348f3
        x-checker-data:
          type: pypi
          name: charset-normalizer

  - name: pycharm
    buildsystem: simple
    build-commands:
      - mkdir pycharm
      - tar xzfv pycharm-community.tar.gz --directory=pycharm/ --strip-components=1
      - rm -f pycharm/help/*
      - install -dm755 ${FLATPAK_DEST}/bin
      - install -dm755 ${FLATPAK_DEST}/pycharm
      - cp -r pycharm/* ${FLATPAK_DEST}/pycharm
      - chmod -R a-s,go+rX,go-w ${FLATPAK_DEST}/pycharm
      - python3 ${FLATPAK_DEST}/pycharm/plugins/python-ce/helpers/pydev/setup_cython.py
        build_ext --inplace
      - install pycharm/bin/pycharm.sh ${FLATPAK_DEST}/bin/pycharm
      - install -t ${FLATPAK_DEST}/share/icons/hicolor/scalable/apps -Dm644 pycharm/bin/pycharm.svg
      - install -t ${FLATPAK_DEST}/share/applications/ -Dm644 com.jetbrains.PyCharm-Community.desktop
      - install -t ${FLATPAK_DEST}/share/appdata/ -Dm644 com.jetbrains.PyCharm-Community.appdata.xml
      - icon_in="${FLATPAK_DEST}/share/icons/hicolor/scalable/apps/pycharm.svg"; icon_out="${FLATPAK_ID}.png";
        for s in {32,64,128,256,512}; do rsvg-convert "${icon_in}" -w "${s}" -h "${s}"
        -a -f png -o "${icon_out}"; install -p -Dm644 "${icon_out}" -t "${FLATPAK_DEST}/share/icons/hicolor/${s}x${s}/apps/";
        done;
      - install -d "${FLATPAK_DEST}/extensions"
      - install -d "${FLATPAK_DEST}/packages"
    sources:
      - type: file
        url: https://download.jetbrains.com/python/pycharm-community-2021.2.1.tar.gz
        sha256: c41ff10b200cd18afd8d46100597f78eb8ce85d97b0754120316673ee6f6a9fc
        dest-filename: pycharm-community.tar.gz
        x-checker-data:
          type: jetbrains
          code: PCC
      - type: file
        path: com.jetbrains.PyCharm-Community.appdata.xml
      - type: file
        path: com.jetbrains.PyCharm-Community.desktop

  - name: wrapper
    buildsystem: meson
    config-opts:
      - -Deditor_binary=/app/pycharm/bin/pycharm.sh
      - -Dprogram_name=pycharm
      - -Deditor_title=PyCharm
    sources:
      - type: dir
        path: jetbrains-flatpak-wrapper
